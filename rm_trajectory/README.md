# 弹道解算

### 单独Pitch补偿

#### 注意事项（必须调零，否则弹道会有固定偏差!!!）

​		陀螺仪可能会有零飘，即陀螺仪返回的0度有可能并非真实0度，需要人为寻找0度，可以通过激光位置判断，尽量测量激光距离大于3m，找到0度后需要在得到的pitch角度上加上目前的零飘

#### 使用方法

​		也可查看测试用test代码文件

```c++
//需要提前创建pitch,yaw
double pitch = 0, yaw = 0;
Eigen::Vector3d position;
position(0) = 0; position(1) = 3000; position(2) = 1000;
//创建基于模型的求解器，init_v为速度：30m/s或18m/s, coeff为空气阻力系数，目前小弹丸为0.03
auto gravity_solver = std::make_shared<rm_trajectory::GravitySolver>(init_v, coeff);
//创建基于实测数据的求解器,init_v为速度：30m/s或者18m/s
auto database_solver = std::make_shared<rm_trajectory::DatabaseSolver>(init_v);
//载入求解器（基于模型或基于数据）
auto trajectory_transform_tool = std::make_shared<rm_trajectory::TransformTool>(solver);
//position 击打点云台系坐标
trajectory_transform_tool->solve(position, pitch, yaw);
//获取pitch，yaw, initial_pitch为零飘角度
pitch = trajectory_transform_tool->pitch_ + initial_pitch;
yaw = trajectory_transform_tool->yaw_;
```

---

## 弹道模型建立

### 17mm小弹丸

#### 模型建立

​		目前空气阻力系数为$0.03$

​		17mm小弹丸发射角度接近水平，可以忽略其竖直方向空气阻力，并且已知空气阻力$f = kv^2$,水平方向上动力学模型：
$$
-kv_x^2 = m \frac{dv_x}{dt}
$$
​		以此为基础，建立弹丸飞行时间$T$的函数并进行牛顿迭代：
$$
T_{k+1} = T_k - \frac{f(T_k)}{df(T_k)}
$$
​		求解出$T$后，对$\theta$进行迭代，比较误差$e_k$进而判断是否结束迭代
$$
h_k = v_0sin\theta _kT - 4.9T^2
$$

$$
e_k = h_r - target
$$

#### 模型效果

​		模型与纯测试结果有基本固定的偏差，需要修正

![image-20220410220651325](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20220410220651325.png)

<p align = 'center'>未加修正对比图</p>

​		添加固定修正后18m/s与30m/s模型与纯测试结果对比图

![image-20220410220913951](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20220410220913951.png)

<p align = 'center'>加修正30m/s对比图</p>

![image-20220410221014049](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20220410221014049.png)

<p align = 'center'>加修正18m/s对比图</p>

## 射表原始数据

### 一、速度为$30m/s$时射表

​		目前测试了$30m/s$速度下，距离分别为$1, 3, 5, 7$米的弹道数据，将每米的数据处理后，对未测试的数据进行差值处理，采用牛顿差值的方法。

- #### 距离为1米射表


每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
| $-20$ |         $523$          |        $997$         |
| $-18$ |         $569$          |        $1002$        |
| $-16$ |         $619$          |        $1010$        |
| $-14$ |        $670.5$         |        $1017$        |
| $-12$ |        $711.6$         |        $1022$        |
| $-10$ |         $130$          |        $364$         |
| $-8$  |         $176$          |        $369$         |
| $-6$  |         $217$          |        $375$         |
| $-4$  |         $259$          |        $383$         |
| $-2$  |         $297$          |        $390$         |
|  $0$  |         $400$          |        $400$         |
|  $2$  |         $450$          |        $405$         |
|  $4$  |         $490$          |        $410$         |
|  $6$  |         $530$          |        $415$         |
|  $8$  |         $570$          |        $420$         |
| $10$  |         $610$          |        $425$         |
| $12$  |         $645$          |        $430$         |
| $14$  |         $685$          |        $435$         |
| $16$  |         $710$          |        $440$         |
| $18$  |         $750$          |        $448$         |
| $20$  |         $795$          |        $455$         |
| $22$  |         $845$          |        $463$         |
| $24$  |         $895$          |        $470$         |
| $26$  |         $945$          |        $477$         |

- #### 距离为3米射表


每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
| $-10$ |        $326.7$         |        $1067$        |
| $-8$  |         $443$          |        $1067$        |
| $-6$  |         $558$          |        $1067$        |
| $-4$  |         $671$          |        $1067$        |
| $-2$  |         $787$          |        $1067$        |
|  $0$  |        $231.8$         |        $400$         |
|  $2$  |         $349$          |        $400$         |
|  $4$  |        $471.7$         |        $400$         |
|  $6$  |         $574$          |        $400$         |
|  $8$  |        $699.25$        |        $400$         |
| $10$  |        $787.5$         |        $400$         |
| $12$  |        $894.5$         |        $400$         |
| $14$  |        $1006.4$        |        $400$         |
| $16$  |        $1116.7$        |        $400$         |
| $18$  |         $1245$         |        $400$         |
| $20$  |         $1386$         |        $400$         |
| $22$  |         $1486$         |        $400$         |
| $24$  |       $1604.75$        |        $400$         |
| $26$  |         $1728$         |        $400$         |
| $28$  |         $1878$         |        $400$         |
| $30$  |         $1987$         |        $400$         |

- #### 距离为5米射表

每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
| $-14$ |        $314.75$        |        $2041$        |
| $-12$ |         $476$          |        $2041$        |
| $-10$ |         $646$          |        $2041$        |
| $-8$  |         $259$          |        $1374$        |
| $-6$  |        $414.5$         |        $1374$        |
| $-4$  |         $605$          |        $1374$        |
| $-2$  |         $820$          |        $1374$        |
|  $0$  |         $1029$         |        $1374$        |
|  $2$  |         $236$          |        $400$         |
|  $4$  |         $370$          |        $400$         |
|  $6$  |         $589$          |        $400$         |
|  $8$  |        $773.5$         |        $400$         |
| $10$  |         $934$          |        $400$         |
| $12$  |        $1119.5$        |        $400$         |
| $14$  |       $1340.25$        |        $400$         |
| $16$  |         $1423$         |        $400$         |
| $18$  |        $1701.8$        |        $400$         |
| $20$  |        $1899.5$        |        $400$         |
| $22$  |        $2148.5$        |        $400$         |
| $24$  |        $2370.5$        |        $400$         |
| $26$  |         $2542$         |        $400$         |
| $28$  |         $2775$         |        $400$         |

- #### 距离为7米射表

每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
| $-8$  |         $319$          |        $2041$        |
| $-6$  |         $571$          |        $2041$        |
| $-4$  |        $847.2$         |        $2041$        |
| $-2$  |       $1103.75$        |        $2041$        |
|  $0$  |         $1424$         |        $2041$        |
|  $2$  |         $1587$         |        $2041$        |
|  $4$  |         $250$          |        $400$         |
|  $6$  |         $510$          |        $400$         |
|  $8$  |        $753.75$        |        $400$         |
| $10$  |         $1037$         |        $400$         |
| $12$  |        $1223.5$        |        $400$         |
| $14$  |         $1541$         |        $400$         |
| $16$  |         $1819$         |        $400$         |
| $18$  |         $2053$         |        $400$         |
| $20$  |        $2308.7$        |        $400$         |
| $22$  |        $2705.7$        |        $400$         |
| $24$  |         $2977$         |        $400$         |

### 二、速度为$18m/s$时射表

​		目前测试了$18m/s$速度下，距离分别为$1, 3, 5, 7$米的弹道数据，将每米的数据处理后，对未测试的数据进行差值处理，采用牛顿差值的方法。

- #### 距离为1米射表


每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
| $-20$ |         $522$          |        $1060$        |
| $-18$ |         $582$          |        $1060$        |
| $-16$ |         $650$          |        $1060$        |
| $-14$ |         $690$          |        $1060$        |
| $-12$ |         $720$          |        $1060$        |
| $-10$ |         $770$          |        $1060$        |
| $-8$  |         $816$          |        $1060$        |
| $-6$  |         $867$          |        $1060$        |
| $-4$  |         $900$          |        $1060$        |
| $-2$  |         $935$          |        $1060$        |
|  $0$  |         $307$          |        $390$         |
|  $2$  |         $365$          |        $390$         |
|  $4$  |         $408$          |        $390$         |
|  $6$  |         $452$          |        $390$         |
|  $8$  |         $500$          |        $390$         |
| $10$  |         $541$          |        $390$         |
| $12$  |         $600$          |        $390$         |
| $14$  |         $622$          |        $390$         |
| $16$  |         $660$          |        $390$         |
| $18$  |         $708$          |        $390$         |
| $20$  |         $764$          |        $390$         |
| $22$  |         $805$          |        $390$         |
| $24$  |         $846$          |        $390$         |

- #### 距离为3米射表


每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
| $-10$ |         $221$          |        $1060$        |
| $-8$  |         $359$          |        $1060$        |
| $-6$  |         $460$          |        $1060$        |
| $-4$  |         $548$          |        $1060$        |
| $-2$  |         $685$          |        $1060$        |
|  $0$  |         $152$          |        $390$         |
|  $2$  |         $257$          |        $390$         |
|  $4$  |         $377$          |        $390$         |
|  $6$  |         $475$          |        $390$         |
|  $8$  |         $573$          |        $390$         |
| $10$  |         $679$          |        $390$         |
| $12$  |         $825$          |        $390$         |
| $14$  |         $951$          |        $390$         |
| $16$  |         $1025$         |        $390$         |
| $18$  |         $1164$         |        $390$         |
| $20$  |         $1260$         |        $390$         |
| $22$  |         $1374$         |        $390$         |

- #### 距离为5米射表

每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
| $-6$  |         $186$          |        $1364$        |
| $-4$  |         $377$          |        $1364$        |
| $-2$  |         $581$          |        $1364$        |
|  $0$  |         $813$          |        $1364$        |
|  $2$  |         $939$          |        $1364$        |
|  $4$  |         $1156$         |        $1364$        |
|  $6$  |         $283$          |        $390$         |
|  $8$  |         $533$          |        $390$         |
| $10$  |         $675$          |        $390$         |
| $12$  |         $842$          |        $390$         |
| $14$  |         $1086$         |        $390$         |
| $16$  |         $1296$         |        $390$         |
| $18$  |         $1526$         |        $390$         |
| $20$  |         $1696$         |        $390$         |

- #### 距离为7米射表

每个数据点由5个实际射击点求均值所得，本表格只显示均值后结果。

| pitch | 射击点相对地面高度$mm$ | 枪口相对地面高度$mm$ |
| :---: | :--------------------: | :------------------: |
|  $2$  |         $299$          |        $1060$        |
|  $4$  |        $563.8$         |        $1060$        |
|  $6$  |         $169$          |        $390$         |
|  $8$  |         $444$          |        $390$         |
| $10$  |         $705$          |        $390$         |
| $12$  |         $958$          |        $390$         |
| $14$  |         $1172$         |        $390$         |
| $16$  |         $1424$         |        $390$         |
| $18$  |       $1671.25$        |        $390$         |
| $20$  |         $1964$         |        $390$         |
| $22$  |         $2129$         |        $390$         |
| $24$  |         $2452$         |        $390$         |
| $26$  |         $2632$         |        $390$         |

---

